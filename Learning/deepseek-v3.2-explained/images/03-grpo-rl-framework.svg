<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <defs>
    <linearGradient id="blueGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="greenGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#48bb78;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#38a169;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="orangeGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f6ad55;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ed8936;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="pinkGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f687b3;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d53f8c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="cyanGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4fd1c5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#319795;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow3" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="700" fill="#f8fafc"/>
  
  <!-- Title -->
  <text x="450" y="35" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1a202c" text-anchor="middle">GRPO 强化学习框架与优化策略</text>
  
  <!-- Main GRPO Flow -->
  <g transform="translate(50, 60)">
    <!-- Question -->
    <g filter="url(#shadow3)">
      <rect x="0" y="0" width="120" height="60" rx="10" fill="url(#blueGrad3)"/>
      <text x="60" y="25" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Question</text>
      <text x="60" y="45" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)" text-anchor="middle">q ~ P(Q)</text>
    </g>
    
    <!-- Arrow -->
    <path d="M125 30 L175 30" stroke="#718096" stroke-width="2" fill="none"/>
    <polygon points="175,25 185,30 175,35" fill="#718096"/>
    
    <!-- Policy Sampling -->
    <g filter="url(#shadow3)">
      <rect x="190" y="0" width="140" height="60" rx="10" fill="url(#greenGrad3)"/>
      <text x="260" y="25" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Policy Sampling</text>
      <text x="260" y="45" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)" text-anchor="middle">{o_i} ~ pi_old</text>
    </g>
    
    <!-- Arrow -->
    <path d="M335 30 L385 30" stroke="#718096" stroke-width="2" fill="none"/>
    <polygon points="385,25 395,30 385,35" fill="#718096"/>
    
    <!-- Response Group -->
    <g filter="url(#shadow3)">
      <rect x="400" y="0" width="160" height="60" rx="10" fill="url(#orangeGrad3)"/>
      <text x="480" y="25" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Response Group</text>
      <text x="480" y="45" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)" text-anchor="middle">{o_1, o_2, ..., o_G}</text>
    </g>
    
    <!-- Arrow -->
    <path d="M565 30 L615 30" stroke="#718096" stroke-width="2" fill="none"/>
    <polygon points="615,25 625,30 615,35" fill="#718096"/>
    
    <!-- Reward -->
    <g filter="url(#shadow3)">
      <rect x="630" y="0" width="140" height="60" rx="10" fill="url(#pinkGrad3)"/>
      <text x="700" y="25" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Reward Model</text>
      <text x="700" y="45" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)" text-anchor="middle">{R_1, R_2, ..., R_G}</text>
    </g>
    
    <!-- Advantage Computation -->
    <path d="M700 65 L700 100 L480 100 L480 130" stroke="#718096" stroke-width="2" fill="none"/>
    <polygon points="475,130 480,140 485,130" fill="#718096"/>
    
    <g filter="url(#shadow3)">
      <rect x="380" y="145" width="200" height="50" rx="10" fill="url(#cyanGrad3)"/>
      <text x="480" y="170" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">Advantage: A = R_i - mean(R)</text>
      <text x="480" y="185" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.8)" text-anchor="middle">组内归一化计算优势</text>
    </g>
  </g>
  
  <!-- Four Key Optimizations -->
  <text x="450" y="280" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2d3748" text-anchor="middle">四大稳定性优化策略</text>
  
  <g transform="translate(30, 300)">
    <!-- Strategy 1: Unbiased KL -->
    <g filter="url(#shadow3)">
      <rect x="0" y="0" width="200" height="130" rx="12" fill="url(#blueGrad3)"/>
      <text x="100" y="30" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">1. Unbiased KL Estimate</text>
      <text x="100" y="50" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.9)" text-anchor="middle">(无偏 KL 估计)</text>
      
      <rect x="15" y="65" width="170" height="50" rx="6" fill="rgba(255,255,255,0.15)"/>
      <text x="100" y="85" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">用重要性采样比率修正</text>
      <text x="100" y="100" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">消除系统估计误差</text>
    </g>
    
    <!-- Strategy 2: Off-Policy Masking -->
    <g filter="url(#shadow3)">
      <rect x="220" y="0" width="200" height="130" rx="12" fill="url(#greenGrad3)"/>
      <text x="320" y="30" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">2. Off-Policy Masking</text>
      <text x="320" y="50" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.9)" text-anchor="middle">(离线策略序列掩码)</text>
      
      <rect x="235" y="65" width="170" height="50" rx="6" fill="rgba(255,255,255,0.15)"/>
      <text x="320" y="85" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">掩盖策略偏移过大的</text>
      <text x="320" y="100" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">负优势序列</text>
    </g>
    
    <!-- Strategy 3: Keep Routing -->
    <g filter="url(#shadow3)">
      <rect x="440" y="0" width="200" height="130" rx="12" fill="url(#orangeGrad3)"/>
      <text x="540" y="30" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">3. Keep Routing</text>
      <text x="540" y="50" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.9)" text-anchor="middle">(保持专家路由)</text>
      
      <rect x="455" y="65" width="170" height="50" rx="6" fill="rgba(255,255,255,0.15)"/>
      <text x="540" y="85" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">MoE 推理/训练保持</text>
      <text x="540" y="100" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">相同专家路由路径</text>
    </g>
    
    <!-- Strategy 4: Keep Sampling Mask -->
    <g filter="url(#shadow3)">
      <rect x="660" y="0" width="200" height="130" rx="12" fill="url(#pinkGrad3)"/>
      <text x="760" y="30" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">4. Keep Sampling Mask</text>
      <text x="760" y="50" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.9)" text-anchor="middle">(保持采样掩码)</text>
      
      <rect x="675" y="65" width="170" height="50" rx="6" fill="rgba(255,255,255,0.15)"/>
      <text x="760" y="85" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">Top-p/Top-k 采样掩码</text>
      <text x="760" y="100" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">训练时保持一致</text>
    </g>
  </g>
  
  <!-- Training Pipeline -->
  <text x="450" y="480" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2d3748" text-anchor="middle">Post-Training 训练流程</text>
  
  <g transform="translate(50, 500)">
    <!-- Specialist Distillation -->
    <g filter="url(#shadow3)">
      <rect x="0" y="0" width="240" height="100" rx="12" fill="url(#cyanGrad3)"/>
      <text x="120" y="25" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">Specialist Distillation</text>
      <text x="120" y="45" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.9)" text-anchor="middle">(专家蒸馏)</text>
      
      <text x="120" y="70" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.8)" text-anchor="middle">数学 / 编程 / 推理</text>
      <text x="120" y="85" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.8)" text-anchor="middle">Agent / 搜索 / 写作</text>
    </g>
    
    <!-- Arrow -->
    <path d="M245 50 L295 50" stroke="#718096" stroke-width="2" fill="none"/>
    <polygon points="295,45 305,50 295,55" fill="#718096"/>
    
    <!-- Mixed RL -->
    <g filter="url(#shadow3)">
      <rect x="310" y="0" width="240" height="100" rx="12" fill="url(#blueGrad3)"/>
      <text x="430" y="25" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">Mixed RL Training</text>
      <text x="430" y="45" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.9)" text-anchor="middle">(混合 RL 训练)</text>
      
      <text x="430" y="70" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.8)" text-anchor="middle">推理 + Agent + 对齐</text>
      <text x="430" y="85" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.8)" text-anchor="middle">单阶段统一训练</text>
    </g>
    
    <!-- Arrow -->
    <path d="M555 50 L605 50" stroke="#718096" stroke-width="2" fill="none"/>
    <polygon points="605,45 615,50 605,55" fill="#718096"/>
    
    <!-- Final Models -->
    <g filter="url(#shadow3)">
      <rect x="620" y="0" width="180" height="100" rx="12" fill="url(#greenGrad3)"/>
      <text x="710" y="25" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">Final Models</text>
      
      <text x="710" y="50" font-family="Arial, sans-serif" font-size="10" fill="white" text-anchor="middle">DeepSeek-V3.2</text>
      <text x="710" y="70" font-family="Arial, sans-serif" font-size="10" fill="white" text-anchor="middle">DeepSeek-V3.2-Speciale</text>
      <text x="710" y="90" font-family="Arial, sans-serif" font-size="9" fill="rgba(255,255,255,0.8)" text-anchor="middle">(更长推理版本)</text>
    </g>
  </g>
  
  <!-- Key Insight -->
  <g transform="translate(100, 620)">
    <rect x="0" y="0" width="700" height="60" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="350" y="25" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#92400e" text-anchor="middle">关键洞察: Post-training 计算量 > 预训练成本的 10%</text>
    <text x="350" y="45" font-family="Arial, sans-serif" font-size="11" fill="#b45309" text-anchor="middle">大幅投入后训练计算,是 V3.2 达到 GPT-5 水平的关键</text>
  </g>
</svg>